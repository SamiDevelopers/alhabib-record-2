<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ù…Ø±ÙƒØ² Ø§Ù„Ø­Ø¨ÙŠØ¨ Ù„Ù„Ø£Ù„Ø­Ø§Ù† ÙˆØ§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ù‚Ø¨Ø·ÙŠØ©</title>
<style>
/* ğŸ¨ Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…Ø±ÙƒØ²: Ø°Ù‡Ø¨ÙŠ - Ø£Ø­Ù…Ø± - ÙƒØ­Ù„ÙŠ */
body {
  font-family: "Cairo", sans-serif;
  background: #fdf8f2;
  margin: 0;
  padding: 0;
  text-align: center;
  direction: rtl;
}
header {
  background: linear-gradient(90deg, #800000, #002147);
  color: white;
  padding: 15px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 15px;
}
header img {
  height: 80px;
}
h1 {
  margin: 0;
  font-size: 22px;
}
section {
  display: none;
  padding: 20px;
}
.active {
  display: block;
}
button {
  background-color: #d4af37;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  color: #002147;
  font-weight: bold;
  cursor: pointer;
  margin: 5px;
  transition: 0.3s;
}
button:hover {
  background-color: #c19b2b;
}
input, select {
  padding: 8px;
  margin: 6px;
  border-radius: 6px;
  border: 1px solid #ccc;
  width: 250px;
  text-align: center;
}
.container {
  max-width: 600px;
  margin: auto;
  background: #fff;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
  border-radius: 15px;
  padding: 20px;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}
th, td {
  border: 1px solid #ccc;
  padding: 8px;
}
th {
  background-color: #002147;
  color: white;
}
footer {
  background: #002147;
  color: white;
  padding: 10px;
  font-size: 14px;
  margin-top: 30px;
}
</style>
</head>

<body>
<header>
  <img src="logo.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø±ÙƒØ²" />
  <h1>Ù…Ø±ÙƒØ² Ø§Ù„Ø­Ø¨ÙŠØ¨ Ù„Ù„Ø£Ù„Ø­Ø§Ù† ÙˆØ§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ù‚Ø¨Ø·ÙŠØ©</h1>
</header>

<!-- ğŸ”¹ ÙˆØ§Ø¬Ù‡Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<section id="login" class="active">
  <div class="container">
    <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
    <button onclick="showStudentLogin()">Ø¯Ø®ÙˆÙ„ ÙƒØ¯Ø§Ø±Ø³ ğŸ“</button>
    <button onclick="showTeacherLogin()">Ø¯Ø®ÙˆÙ„ ÙƒØ®Ø§Ø¯Ù… ğŸ™Œ</button>
    <div id="student-login" style="display:none;">
      <input type="text" id="studentCode" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø±Ø³" />
      <button onclick="studentLogin()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
    </div>
    <div id="teacher-login" style="display:none;">
      <input type="password" id="teacherPass" placeholder="ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ø®Ø§Ø¯Ù…" />
      <button onclick="teacherLogin()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
    </div>
  </div>
</section>

<!-- ğŸ”¹ Ù„ÙˆØ­Ø© Ø§Ù„Ø¯Ø§Ø±Ø³ -->
<section id="studentPanel">
  <div class="container">
    <h2>Ù„ÙˆØ­Ø© Ø§Ù„Ø¯Ø§Ø±Ø³</h2>
    <p id="studentName"></p>
    <button onclick="uploadAssignment('Ø§Ù„Ø·Ù‚ÙˆØ³')">Ø±ÙØ¹ ÙˆØ§Ø¬Ø¨ Ø§Ù„Ø·Ù‚ÙˆØ³</button>
    <button onclick="uploadAssignment('Ø§Ù„Ù‚Ø¨Ø·ÙŠØ©')">Ø±ÙØ¹ ÙˆØ§Ø¬Ø¨ Ø§Ù„Ù‚Ø¨Ø·ÙŠØ©</button>
    <button onclick="logout()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
  </div>
</section>

<!-- ğŸ”¹ Ù„ÙˆØ­Ø© Ø§Ù„Ø®Ø§Ø¯Ù… -->
<section id="teacherPanel">
  <div class="container">
    <h2>Ù„ÙˆØ­Ø© Ø§Ù„Ø®Ø§Ø¯Ù…</h2>
    <button onclick="registerNewStudent()">â• ØªØ³Ø¬ÙŠÙ„ Ø¯Ø§Ø±Ø³ Ø¬Ø¯ÙŠØ¯</button>
    <button onclick="recordStudentAttendance()">ğŸ—“ï¸ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØºÙŠØ§Ø¨</button>
    <button onclick="recordGrades('Ø§Ù„Ø·Ù‚ÙˆØ³')">ğŸ“˜ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø·Ù‚ÙˆØ³</button>
    <button onclick="recordGrades('Ø§Ù„Ù‚Ø¨Ø·ÙŠØ©')">ğŸ“™ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ù‚Ø¨Ø·ÙŠØ©</button>
    <button onclick="logout()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    <div id="contentArea"></div>
  </div>
</section>

<footer>Â© Ù…Ø±ÙƒØ² Ø§Ù„Ø­Ø¨ÙŠØ¨ Ù„Ù„Ø£Ù„Ø­Ø§Ù† ÙˆØ§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ù‚Ø¨Ø·ÙŠØ© - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</footer>

<script>
/* ===========================
   ğŸ§© ÙƒÙˆØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ Ø§Ù„ÙƒØ§Ù…Ù„
   =========================== */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxhoX_QTwmzq7xVThH13IoUxe4WKX0U5aK8Wptc513Ohh94uUToSyfWNj32mve_A5Yi/exec";

// ğŸŒŸ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø±Ø¶
function showSection(id) {
  document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}
function showStudentLogin() {
  document.getElementById("student-login").style.display = "block";
  document.getElementById("teacher-login").style.display = "none";
}
function showTeacherLogin() {
  document.getElementById("teacher-login").style.display = "block";
  document.getElementById("student-login").style.display = "none";
}

// ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¯Ø§Ø±Ø³
function studentLogin() {
  const code = document.getElementById("studentCode").value.trim();
  if (!code) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø±Ø³");
  sessionStorage.setItem("studentCode", code);
  document.getElementById("studentName").innerText = "ÙƒÙˆØ¯Ùƒ: " + code;
  showSection("studentPanel");
}

// ğŸ™Œ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø®Ø§Ø¯Ù…
function teacherLogin() {
  const pass = document.getElementById("teacherPass").value.trim();
  if (pass === "987654") {
    showSection("teacherPanel");
  } else {
    alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
  }
}

// ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
function logout() {
  sessionStorage.clear();
  showSection("login");
}

/* ======================================================
   1ï¸âƒ£ Ø±ÙØ¹ ÙˆØ§Ø¬Ø¨ Ø§Ù„Ø¯Ø§Ø±Ø³
====================================================== */
function uploadAssignment(subject) {
  const studentCode = sessionStorage.getItem("studentCode");
  if (!studentCode) return alert("ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
  const input = document.createElement("input");
  input.type = "file";
  input.accept = ".pdf,.jpg,.jpeg,.png";
  input.onchange = (e) => {
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload = function() {
      const base64 = reader.result;
      const assignment = {
        action: "uploadAssignment",
        assignment: {
          code: studentCode,
          subject: subject,
          fileName: file.name,
          fileData: base64,
          mimeType: file.type
        }
      };
      fetch(SCRIPT_URL, {
        method: "POST",
        body: JSON.stringify(assignment)
      })
      .then(res => res.text())
      .then(msg => alert(msg))
      .catch(err => alert("Ø­Ø¯Ø« Ø®Ø·Ø£: " + err));
    };
    reader.readAsDataURL(file);
  };
  input.click();
}

/* ======================================================
   2ï¸âƒ£ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª
====================================================== */
function recordGrades(subject) {
  const content = document.getElementById("contentArea");
  content.innerHTML = `<h3>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø±Ø¬Ø§Øª Ù…Ø§Ø¯Ø©: ${subject}</h3>
  <input type='text' id='stCode' placeholder='ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø±Ø³'>
  <input type='number' id='gradeVal' min='0' max='10' placeholder='Ø§Ù„Ø¯Ø±Ø¬Ø©'>
  <input type='number' id='weekNum' min='1' max='15' placeholder='Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹'>
  <button onclick='saveGrade("${subject}")'>ğŸ’¾ Ø­ÙØ¸</button>`;
}
function saveGrade(subject) {
  const code = document.getElementById("stCode").value.trim();
  const grade = document.getElementById("gradeVal").value;
  const week = document.getElementById("weekNum").value;
  if (!code || !grade || !week) return alert("Ø£Ø¯Ø®Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
  fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "saveGrades",
      gradeList: [{ code, subject, week, grade }]
    })
  })
  .then(res => res.text())
  .then(msg => alert(msg))
  .catch(err => alert("Ø­Ø¯Ø« Ø®Ø·Ø£: " + err));
}

/* ======================================================
   3ï¸âƒ£ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØºÙŠØ§Ø¨
====================================================== */
function recordStudentAttendance() {
  const content = document.getElementById("contentArea");
  content.innerHTML = `
    <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØºÙŠØ§Ø¨</h3>
    <input type="text" id="attCode" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø±Ø³">
    <select id="attWeek">
      ${Array.from({ length: 10 }, (_, i) => `<option value="${i+1}">Ø£Ø³Ø¨ÙˆØ¹ ${i+1}</option>`).join("")}
    </select>
    <select id="attStatus">
      <option value="true">Ø­Ø§Ø¶Ø±</option>
      <option value="false">ØºØ§Ø¦Ø¨</option>
    </select>
    <button onclick="saveAttendance()">ğŸ’¾ Ø­ÙØ¸</button>`;
}
function saveAttendance() {
  const code = document.getElementById("attCode").value.trim();
  const week = parseInt(document.getElementById("attWeek").value) - 1;
  const status = document.getElementById("attStatus").value === "true";
  if (!code) return alert("Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø±Ø³");
  fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "saveAttendance",
      attendanceList: [{ code, attendance: Array(10).fill(false).map((v, i) => i === week ? status : v) }]
    })
  })
  .then(res => res.text())
  .then(msg => alert(msg))
  .catch(err => alert("Ø­Ø¯Ø« Ø®Ø·Ø£: " + err));
}

/* ======================================================
   4ï¸âƒ£ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø§Ø±Ø³ Ø¬Ø¯ÙŠØ¯
====================================================== */
function registerNewStudent() {
  const name = prompt("Ø§Ø³Ù… Ø§Ù„Ø¯Ø§Ø±Ø³:");
  const code = prompt("ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø±Ø³ (ÙØ±ÙŠØ¯):");
  if (!name || !code) return alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ÙƒÙˆØ¯ Ù…Ø¹Ù‹Ø§");
  fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "addStudent",
      student: { name, code }
    })
  })
  .then(res => res.text())
  .then(msg => alert(msg))
  .catch(err => alert("Ø­Ø¯Ø« Ø®Ø·Ø£: " + err));
}
</script>
</body>
</html>
